#import "@preview/modern-g7-32:0.2.0": abstract, gost

#let leading = 1.5em
#let leading = leading - 0.45em
#set block(spacing: leading)
#set par(leading: leading, spacing: leading)

#show: gost.with()

= Практическая работа 10

== Задачи практической работы:
Требуется выполнить следующие пункты:
- ознакомиться с теорией;
- описать бизнес-экраны и функциональность;
- описать маршрутную карту;
- обосновать пакет хранения экранов состояний;
- разработать бизнес-экраны;
- выполненить практическое задание;
- запустить проект.

#pagebreak()

= 1. Теория

= 2. Бизнес-экраны и функциональность
В таблице 2.1 представлены основные бизнес-экраны приложения и их функциональное назначение.

#figure(
  table(
    columns: (auto, auto, auto),
    align: (left, left, left),
    [Экран], [Путь], [Бизнес-функциональность],
    [WelcomeScreen], [/welcome], [Экран приветствия],
    [LoginScreen], [/login], [Вход в аккаунт],
    [RegisterScreen], [/register], [Регистрация],
    [HomeScreen], [/], [Главное меню, "Сейчас читаю"],
    [ProfileScreen], [/profile], [Профиль, настройки],
    [MyMoviesScreen], [/my-collection], [Все фильмы, поиск, фильтры],
    [WatchedMoviesScreen], [/read-movies], [Прочитанные фильмы],
    [ToCookScreen], [/want-to-read], [Фильмы "Хочу посмотреть"],
    [RatingsScreen], [/ratings], [Оценки и отзывы],
    [StatisticsScreen], [/statistics], [Общая статистика],
    [RecommendationsScreen], [/recommendations], [Рекомендации],
    [ReadingHistoryScreen], [/reading-history], [История просмотра],
    [ReadingGoalsScreen], [/reading-goals], [Цели просмотра],
    [FeedbackScreen], [/feedback], [Обратная связь],
    [MovieDetailScreen], [/Movie/:id], [Карточка фильмы],
    [ReaderScreen], [/reader], [Просмотр фильмы],
    [MovieNotesScreen], [/Movie-notes/:movieId], [Заметки к фильмове],
    [MovieFormScreen], [/Movie-form], [Редактирование фильмы],
  ),
  caption: [Бизнес-экраны приложения],
)

Описание переходов между экранами:

1. Группа авторизации
   - `WelcomeScreen` (/welcome): Стартовый экран. Ведет на `/login`.
   - `LoginScreen` (/login): Экран входа. Переходы: на `/register` (регистрация) или на `/` (главная).
   - `RegisterScreen` (/register): Экран регистрации. Переходы: на `/login` (вход) или на `/` (главная).

#pagebreak()
2. Главный экран и меню (`HomeScreen`)
Является центральным узлом навигации (`/`). Отсюда доступны переходы:
   - В профиль: `/profile`.
   - К спискам фильмов: `/my-collection` (все), `/read-movies` (просмотренные), `/want-to-read` (хочу посмотреть).
   - К дополнительным разделам: `/statistics` (статистика), `/ratings` (оценки), `/recommendations` (рекомендации).
   - Напрямую к фильмове: `/Movie/:id` (через виджет "Сейчас читаю").

3. Группа профиля (`ProfileScreen`)
Экран профиля (`/profile`) позволяет перейти к:
   - Истории просмотра: `/reading-history`.
   - Целям просмотра: `/reading-goals`.
   - Обратной связи: `/feedback`.
   - Возврат на главную: `/`.

4. Группа фильмы (`MovieDetailScreen`)
Карточка фильмы (`/Movie/:id`) доступна из списков фильмов или с главной. Из нее можно попасть в:
   - Режим просмотра: `/reader`.
   - Заметки к фильмове: `/Movie-notes/:movieId`.
   - Редактирование фильмы: `/Movie-form`.

= 3. Маршрутная карта
Маршрутизация в приложении построена на базе пакета `go_router` и организована по иерархическому принципу. Центральным узлом навигации является Главный экран (`HomeScreen`), доступ к которому открывается после успешной авторизации.

Основные навигационные сценарии можно разделить на несколько логических групп:

1. Сценарий входа и регистрации.
При запуске приложения неавторизованный пользователь попадает на экран приветствия (`/welcome`). Оттуда осуществляется переход на экран входа (`/login`). Если у пользователя нет аккаунта, он может перейти на экран регистрации (`/register`). Между экранами входа и регистрации реализована двусторонняя навигация. После успешного входа или создания аккаунта пользователь перенаправляется на корневой маршрут (`/`).

2. Навигация с Главного экрана.
Главный экран (`/`) служит отправной точкой для доступа к основным разделам приложения. Пользователь может перейти к своей коллекции фильмов (`/my-collection`), спискам просмотренного (`/read-movies`) и запланированного (`/want-to-read`). Также с главного экрана доступны разделы статистики (`/statistics`), рейтингов (`/ratings`) и персональных рекомендаций (`/recommendations`).

3. Раздел профиля.
Переход в профиль (`/profile`) открывает доступ к личным настройкам и дополнительным функциям. Из этого раздела пользователь может попасть в историю просмотра (`/reading-history`), экран управления целями (`/reading-goals`) и форму обратной связи (`/feedback`).

4. Работа с фильмовой.
При выборе фильмы из любого списка или виджета происходит переход на экран детальной информации (`/Movie/:id`). Этот экран является узловым для действий с конкретной фильмовой: отсюда можно перейти в режим просмотра (`/reader`), открыть заметки к фильмове (`/Movie-notes/:movieId`) или перейти к редактированию данных о фильмове (`/Movie-form`).

Ниже представлена схема маршрутной карты, отображающая все экраны и связи между ними. На рисунке 1 показана общая структура навигации приложения, включая потоки авторизации, главного меню и вложенных экранов.

#figure(image("marshr.svg", height: 80%), caption: "Маршуртная карта приложения") <fig:roadmap>

= 4. Выбранный пакет для хранения экранов состояний
Для управления состоянием приложения был выбран пакет `flutter_bloc`.

Обоснование выбора:

1. Архитектурная целостность: BLoC (Business Logic Component) идеально вписывается в чистую архитектуру, обеспечивая четкое разделение между слоем представления (UI) и слоем бизнес-логики. Это позволяет менять UI без изменения логики и наоборот.

2. Управление потоками данных: BLoC основан на стримах (Streams), что позволяет эффективно обрабатывать асинхронные события (загрузка данных, ввод пользователя) и последовательно обновлять интерфейс.

3. Тестируемость: Поскольку логика отделена от виджетов, классы BLoC легко тестировать с помощью unit-тестов, проверяя соответствие входных событий выходным состояниям.

4. Масштабируемость и поддержка: Пакет является стандартом в индустрии Flutter-разработки, имеет отличную документацию и поддержку сообщества. Это упрощает онбординг новых разработчиков и поддержку проекта в будущем.

В приложении используются:
- Bloc: Для сложных сценариев, требующих обработки событий (например, `MoviesBloc` для загрузки, добавления, удаления фильмов).
- Cubit: Для простых состояний (например, `ThemeCubit` для переключения темы, `ProfileCubit` для управления данными профиля).

= 5. Разработка бизнес-экранов
В данном разделе рассматривается реализация двух ключевых бизнес-экранов приложения: Экран моей коллекции (`MyMoviesScreen`) и Экран детальной информации о фильмове (`MovieDetailScreen`).

Ниже представлена структура проекта, демонстрирующая разделение на слои и организацию файлов по фичам (features). На рисунке 2 отображено дерево файлов проекта, где видно разделение на core, features и shared модули.

#figure(image("image-15.png", height: 70%), caption: "Структура проекта") <fig:structure>

== 5.1. Используемые модели данных
Для работы выбранных экранов используются следующие модели данных:

1. Модель `Movie`:
   Описывает сущность фильмы в приложении. Содержит поля:
   - `id` (String): Уникальный идентификатор.
   - `title` (String): Название фильмы.
   - `author` (String): Автор.
   - `genre` (String): Жанр.
   - `description` (String?): Описание/аннотация.
   - `isRead` (bool): Флаг пропросмотра.
   - `rating` (int?): Пользовательская оценка.
   - `imageUrl` (String?): Ссылка на обложку.
   - `filePath` (String?): Путь к файлу фильмы.

2. Модель `WatchSession`:
   Используется для отслеживания прогресса просмотра (связана с фильмовой через `movieId`).
   - `id` (String): Идентификатор сессии.
   - `movieId` (String): ID фильмы.
   - `date` (DateTime): Дата просмотра.
   - `pagesRead` (int?): Количество просмотренных страниц.
   - `duration` (Duration?): Время просмотра.

== 5.2. Реализация экрана моей коллекции (`MyMoviesScreen`)
Этот экран отвечает за отображение списка фильмов с возможностью фильтрации и сортировки. Он подписывается на состояние `MoviesBloc` и перестраивает интерфейс при изменении списка фильмов. На рисунке 3 представлен фрагмент кода файла `my_collection_screen.dart`, демонстрирующий использование `BlocBuilder` для отображения списка фильмов.

#figure(image("image-13.png", height: 90%), caption: "Файл my_collection_screen.dart") <fig:code_collection>

Результат работы данного кода можно увидеть на рисунке 4. Здесь показан интерфейс экрана "Моя коллекция" с отображением списка добавленных фильмов и панелью поиска.

#figure(image("image-10.png", height: 80%), caption: "Реализованный экран коллекции фильмов") <fig:screen_collection>

#pagebreak()
== 5.3. Реализация экрана детальной информации (`MovieDetailScreen`)
Экран отображает полную информацию о фильмове и предоставляет доступ к действиям (просмотр, редактирование). Он принимает объект `Movie` через параметры навигации. На рисунке 5 приведен фрагмент кода `book_detail_screen.dart`, показывающий верстку основных элементов карточки фильмы.

#figure(image("image-12.png", height: 80%), caption: "Файл book_detail_screen.dart") <fig:code_detail>

Визуальное представление этого экрана продемонстрировано на рисунке 6. Пользователь видит обложку, название, автора и кнопки управления статусом фильмы.

#figure(image("image-3.png", height: 80%), caption: "Реализованный экран детальной информации о фильмове") <fig:screen_detail>

= 6. Выполнение практического задания
В ходе выполнения работы были реализованы все запланированные экраны и функциональность. Приложение позволяет управлять библиотекой фильмов, отслеживать прогресс просмотра и просматривать статистику.

= 7. Запуск проекта
Для запуска проекта необходимо выполнить следующие команды в терминале:

1. Установить зависимости:
```bash
flutter pub get
```

2. Запустить приложение:
```bash
flutter run
```

Ниже представлены скриншоты работы приложения.

Экран приветствия (`WelcomeScreen`). Первый экран, который видит пользователь. На рисунке 7 показан интерфейс стартового экрана с логотипом и кнопкой начала работы.

#figure(image("image.png", height: 80%), caption: "Стартовый экран приложения") <fig:welcome>

Экран авторизации (`LoginScreen`). Форма входа в приложение. На рисунке 8 представлена форма ввода логина и пароля для доступа к аккаунту.

#figure(image("image-20.png", height: 80%), caption: "Экран авторизации") <fig:login>

Экран регистрации (`RegisterScreen`). Форма создания аккаунта. На рисунке 9 изображен экран регистрации нового пользователя с полями для ввода данных.

#figure(image("image-19.png", height: 80%), caption: "Экран регистрации") <fig:register>

Главный экран (`HomeScreen`). Дашборд с меню. На рисунке 10 показан главный экран приложения, предоставляющий доступ к основным разделам через навигационное меню.

#figure(image("image-1.png", height: 80%), caption: "Домашняя страница приложения") <fig:home>

Экран просмотра (`ReaderScreen`). Интерфейс просмотра фильмы. На рисунке 11 продемонстрирован процесс просмотра фильмы с отображением текста и элементов управления.

#figure(image("image-5.png", height: 80%), caption: "Экран просмотра фильмы") <fig:reader>

Экран профиля (`ProfileScreen`). Настройки пользователя и темы. На рисунке 12 показан профиль пользователя с возможностью редактирования данных и смены темы оформления.

#figure(image("image-21.png", height: 80%), caption: "Экран профиля пользователя") <fig:profile>

Экран истории просмотра (`ReadingHistoryScreen`). Список завершенных сессий просмотра. На рисунке 13 отображен список записей о просмотренных фильмх с указанием даты и времени.

#figure(image("image-7.png", height: 80%), caption: "Экран истории просмотра") <fig:history>

Экран статистики (`StatisticsScreen`). Cводная информация по чтению. На рисунке 14 представлена визуализация статистических данных о прогрессе просмотра пользователя.

#figure(image("image-28.png", height: 80%), caption: "Экран статистики просмотра") <fig:stats>

Экран обратной связи (`FeedbackScreen`). Форма отправки отзыва. На рисунке 15 показана форма для отправки сообщений разработчикам с возможностью прикрепления скриншотов.

#figure(image("image-8.png", height: 80%), caption: "Экран обратной связи") <fig:feedback>

Экран импорта (`ImportScreen`). Экран для добавления фильмов из файловой системы. На рисунке 16 изображен интерфейс выбора файлов для добавления новых фильмов в библиотеку.

#figure(image("image-2.png", height: 80%), caption: "Экран импорта фильмов") <fig:import>

Экран заметок (`MovieNotesScreen`). Список заметок к конкретной фильмове. На рисунке 17 представлен список пользовательских заметок, созданных во время просмотра фильмы.

#figure(image("image-4.png", height: 80%), caption: "Экран заметок к фильмове") <fig:notes>

Экран рекомендаций (`RecommendationsScreen`). Персональные рекомендации фильмов. На рисунке 18 показан список рекомендованных фильмов, подобранных на основе предпочтений пользователя.

#figure(image("image-6.png", height: 80%), caption: "Экран с персональными рекомендациями") <fig:recommendations>

Экран целей просмотра (`ReadingGoalsScreen`). Установка и отслеживание целей по чтению. На рисунке 19 отображен интерфейс для установки и отслеживания прогресса по целям просмотра.

#figure(image("image-9.png", height: 80%), caption: "Экран целей просмотра") <fig:goals>

= Вывод
В ходе практической работы было разработано мобильное приложение для просмотра и учета фильмов на фреймворке Flutter. Изучены и применены на практике принципы чистой архитектуры и паттерн BLoC для управления состоянием. Реализована навигация с помощью `go_router`, работа с локальным хранилищем данных и интеграция функционала просмотра электронных фильмов.

= Приложения
Приложение А. Github репозиторий
#pagebreak()

== Приложение А
Ссылка на Github репозитории с выполненной практической работой №10: http://github.com/Zorynix/rkmp_5


